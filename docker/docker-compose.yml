version: "3.8"

services:
  backend:
    # Build using the Dockerfile that lives at docker/backend/Dockerfile
    build:
      context: ..
      dockerfile: docker/backend/Dockerfile
    image: slowfall-backend:local
    container_name: slowfall-backend-local
    environment:
      # Run in dev profile by default; change or remove as needed
      SPRING_PROFILES_ACTIVE: dev
    ports:
      - "8080:8080"
    restart: unless-stopped
    healthcheck:
      test: [ "CMD-SHELL", "curl -f http://localhost:8080/actuator/health || exit 1" ]
      interval: 30s
      timeout: 5s
      retries: 3

# Notes:
# - Run this file from the docker/ directory with: docker compose up --build
#   but it's easier to run from the repo root so the build context (..) is correct:
#     cd "C:\Cloud Storage\BaseFolder\JavaProjects\slowfall"
#     docker compose -f docker/docker-compose.yml up --build
# - To enable remote JVM debugging temporarily, pass an override env var on the CLI:
#     docker compose -f docker/docker-compose.yml up --build -d
#     docker run --rm --name slowfall-debug -p 5005:5005 -e JAVA_TOOL_OPTIONS='-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:5005' slowfall-backend:local
#   (or add the env var to this service in a developer-only override file)
# - If you want a Postgres service included, I can add a small db service and volumes in a follow-up.

